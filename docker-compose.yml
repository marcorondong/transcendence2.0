services:
  pong-api:
    image: pong-api-img
    container_name: pong-api
    build:
      context: ./ssg/pong-api
      dockerfile: Dockerfile
    volumes:
      - ./ssg/pong-api/src/:/pong/pong-api/src/
    ports:
      - 3010:3010 #TODO remove it will not be exposed at final version
    command: ["npm", "--prefix", "/pong/pong-api/", "run", "dev"]
    networks:
      - Transcendence2.0
  ai-bot:
    build:
      context: ./ssg
      dockerfile: ./AI/Dockerfile
    container_name: ai-bot
    ports:
      - "6969:6969" #TODO close this port when we have users and API!
    environment:
      - NODE_ENV=production
    networks:
      - Transcendence2.0

  frontend:
    build:
      context: ./frontend
      dockerfile: docker/nginx/Dockerfile-Nginx
    container_name: frontend
    # image: nginx:1.26.2
    volumes:
      - ./frontend/volume:/usr/share/nginx/html
      - ./frontend/docker/nginx/config/nginx.conf:/etc/nginx/nginx.conf
      # - ./src/frontend/docker/certificate/localhost.key:/etc/nginx/localhost.key
      # - ./src/frontend/docker/certificate/localhost.crt:/etc/nginx/localhost.crt
    ports:
      - "8080:443"
    restart: unless-stopped
    networks:
      - Transcendence2.0

  tictactoe:
    image: tictactoe_img 
    container_name: tictactoe_container
    build: ./tictactoe
    volumes:
      - ./tictactoe/src/:/tictactoe_api/src/ # TODO remove this in production
      - ./tictactoe/public/:/tictactoe_api/public/ # TODO remove this when there is real frontend
    ports:
      - 3001:3001 # TODO remove this in production
    depends_on:
      - tictactoe_db
    networks:
      - Transcendence2.0
    restart: always

  tictactoe_db:
    image: tictactoe_db_img 
    container_name: tictactoe_db_container
    build: ./tictactoe_db
    environment:
      - DATABASE_URL=file:/tictactoe_db/DB/tictactoeDB.db
    volumes:
      - ./tictactoe_db/src/:/tictactoe_db/src/ # TODO remove this in production
      - ./tictactoe_db/prisma/:/tictactoe_db/prisma/ # TODO remove this in production
      # - /home/iguliyev/DBs/tictactoe/:/tictactoe_api/DB/ # TODO uncomment this line when using the local DB
    ports:
      - 3003:3003 # TODO remove this in production
    networks:
      - Transcendence2.0
    restart: always

networks:
  Transcendence2.0:
